function setClickBg(){var t=$("#hideType").val(),e=$("#a"+t).attr("class");$("#a"+t).css("background","url('images/frame"+e+"_visited.jpg') no-repeat center")}function public_validate(t,e){return null==t||t.length>10||t.length<1?(showError("相册名称长度不正确,1-10位"),!1):null==e||e.length>25||e.length<1?(showError("相册描述长度不正确,1-25位"),!1):!0}function opAlbum(t,e,i,a){var n="<div id='typeError' style='margin:20px 20px 20px 20px;text-align:left;width:320px;font-size:12px;color:#000;'><div>名称: <input type='text' id='cat' size='30' value='"+e+"' maxlength='10'/> <span style='color:#999;'>[不超过10个字符]</span></div><div style='margin:5px 0 0px 0;'>描述: <span style='color:#999;'>[最多不能超过25个字符]</span></div><div style='margin:0px 30px;'><textarea id='desc' style='width:290px;height:80px;' >"+i+"</textarea></div><div id='error' style='margin:5px 30px;color:red;'></div><div style='margin:5px 30px';>";a?(n+="<input type='button' value='修改' onclick='alterImgType("+t+")'/>",title="编辑相册"):(n+="<input type='button' value='添加' onclick='addImgType()'/>",title="创建新相册"),n+="</div></div>",Show(n,title,340,80)}function Show(t,e,i,a){var n=new Popup({contentType:2,isReloadOnClose:!1,width:i,height:a});n.setContent("title",e),n.setContent("contentHtml",t),n.build(),n.show()}function alterImgType(t){var e=$("#cat").val(),i=$("#desc").val();public_validate(e,i)&&$.getJSON("editImageType.action",{image_type_id:t,type_name:e,type_desc:i},function(t){t.result?(ShowAlert("编辑相册成功","编辑相册"),location.reload()):showError(t.tips)})}function addImgType(){var t=$("#cat").val(),e=$("#desc").val();public_validate(t,e)&&$.getJSON("addImageType.action",{type_name:t,type_desc:e},function(i){i.result?(ShowAlert("创建新相册成功","创建新相册"),create_new_album(i.myid,t,e)):showError(i.tips),o_pop.reBuild()})}function ShowAlert(t,e){var i=new Popup({contentType:4,isReloadOnClose:!1,width:340,height:70});i.setContent("title",e),i.setContent("alertCon",t),i.build(),i.show()}function create_new_album(t,e,i){str="<li class='li"+t+"'><a href='imgListShow.htm?type="+t+"' class='ls'><img src='images/album_no_pic.gif'/></a><a href='#' id='name"+t+"' class='aname'>"+e+"(0)</a><s:if test='#log!=null'><br><a href=javascript:opAlbum("+t+",'"+e+"','"+i+"',true); class='aop'>√编辑</a><a href='javascript:delAlbum("+t+")' class='aop'>×删除</a></s:if></li>",$("#albumcenter ul").append(str);var a=$("#typeid option");a.length>0&&window.location.reload()}function showError(t){$("#error").text(t).fadeIn("fast").fadeOut(3e3)}function delAlbum(t){var e=new Popup({contentType:3,isReloadOnClose:!1,width:340,height:80});e.setContent("title","删除相册"),e.setContent("confirmCon","您确定要删除这个相册吗?"),e.setContent("callBack",delAlbumCallBack),e.setContent("parameter",{id:t,obj:e}),e.build(),e.show()}function preview(t){var e=new Popup({contentType:2,isReloadOnClose:!1,width:700});e.setContent("title","图片预览"),e.setContent("scrollType","no"),e.setContent("contentHtml","<html><head></style></head><body><img style='width:100%' src='"+t+"'/></body></html>"),e.build(),e.show()}function delAlbumCallBack(t){var e=t.id;e>1&&$.getJSON("deleteImageType.action",{image_type_id:e},function(i){var a=t.obj;a.config.contentType=4,i.result?(a.setContent("alertCon","删除成功,此相册下相片将会全部删除!"),$(".li"+e).hide()):"no_login"==i.tips?login():a.setContent("alertCon",i.tips),a.reBuild()})}function opImg(t,e,i){str="<div style='margin:20px 10px 20px 30px;text-align:left;width:450px;font-size:12px;color:#000;'><div style=''>预览: <span style='color:#999;'></span><div style='margin:0 0 5px 30px;'><img src='"+e+"'/></div></div><div style='margin:5px 0 0px 0;'>描述: <span style='color:#999;'>[最多不能超过15个字符]</span></div><div style='margin:0px 30px;'><textarea id='desc' style='width:290px;height:60px;' >"+i+"</textarea></div><div id='error' style='margin:5px 30px;color:red;'></div><div style='margin:5px 30px';><input type='button' width='120px' value='编辑' onclick='alterImg("+t+")'/></div></div>",Show(str,"编辑图片",500,300)}function alterImg(t){var e=$("#desc").val();return null==e||e.length>15||e.length<1?void showError("相片描述长度不正确,1-15位"):void(t>0&&$.getJSON("editImage.action",{img_id:t,img_desc:e},function(i){i.result?(ShowAlert("编辑相片成功","编辑相片"),$("#name"+t).html(e)):showError(i.tips)}))}function delImg(t){var e=new Popup({contentType:3,isReloadOnClose:!1,width:340,height:60});e.setContent("title","删除相片"),e.setContent("confirmCon","您确定要删除这张相片吗?"),e.setContent("callBack",delImgCallBack),e.setContent("parameter",{id:t,obj:e}),e.build(),e.show()}function delImgCallBack(t){var e=t.id;e>0&&$.getJSON("deleteImage.action",{img_id:e},function(i){o_pop=t.obj,o_pop.config.contentType=4,i.result?(o_pop.setContent("alertCon","删除相片成功"),$(".li"+e).hide()):o_pop.setContent("alertCon","删除相片失败"),o_pop.reBuild()})}function setWidthAndHeight(t){var e,i=400,a=550,n=t.lastIndexOf("*"),l=t.lastIndexOf("|"),r=t.substring(0,n),o=t.substring(n+1,l);$("#si").css("margin-top","0"),r>=a&&(r=a),o>=i?o=i:(e=(i-o)/2,$("#si").css("margin-top",e+"px")),$("#si").css("width",r+"px"),$("#si").css("height",o+"px")}function showBefore(t,e,i){setWidthAndHeight(i),getAllImg(t,e)}function getAllImg(t,e){$.getJSON("imgShowAjax.htm",{id:t,iid:e},function(t){list=t.mylist,id=t.myid;for(var e=0;e<list.length;e+=1)if(list[e].id==id){pos=e+1,0==e?($(".pre").attr("href","javascript:;").attr("title","已经是第一张"),$(".next").attr("href","javascript:showNext("+pos+")").attr("title","下一张")):e==list.length-1?($(".next").attr("href","javascript:;").attr("title","已经是最后一张"),$(".pre").attr("href","javascript:showPre("+pos+")").attr("title","上一张")):($(".pre").attr("href","javascript:showPre("+pos+")").attr("title","上一张"),$(".next").attr("href","javascript:showNext("+pos+")").attr("title","下一张")),$(".current").html(pos);break}getP(list,id)})}function getP(t,e){imglist=t,imgid=e}function setAllInfo(t){t-=1;var e=imglist[t].imgurl,i=imglist[t].imgname,a=imglist[t].imgdesc,n=imglist[t].imginfo,l=imglist[t].time;setWidthAndHeight(n),$(".current").html(t+1),$("#link").attr("href",e+"/"+i),$("#si").attr("src",e+"/"+i),$("#si").attr("alt",a+"--"+n),$(".des").html(a),$(".inf").html(n),$(".tim").html(l)}function showPre(t){1!=t?(pos=t-1,$(".pre").attr("href","javascript:showPre("+pos+")").attr("title","上一张"),$(".next").attr("title","下一张"),setAllInfo(pos)):(pos=t,$(".pre").attr("href","javascript:;").attr("title","已经是第一张")),$(".next").attr("href","javascript:showNext("+pos+")")}function showNext(t){t!=imglist.length?(pos=t+1,$(".pre").attr("title","上一张"),$(".next").attr("href","javascript:showNext("+pos+")").attr("title","下一张"),setAllInfo(pos)):$(".next").attr("href","javascript:;").attr("title","已经是最后一张"),$(".pre").attr("href","javascript:showPre("+pos+")")}function appendFile(t){for(var e="",i=3;5>i;i++)e+='<div class="onefile"><div class="file"><input type="file" name="upload" id="file'+i+'" onchange="fileupload(this,'+i+')" /><br><span id="error'+i+'" class="error"></span></div><div class="preview"><img id="pre'+i+'" src="'+defaultpic+'"/></div><div class="desc">描述:<br><textarea name="desc" id="desc'+i+'"></textarea></div></div>',item+=1;$("#uploadarea").append(e)}function addmore(t){appendFile(t),$(".addmore").hide()}function initTypeId(){var t=0;tid=$("#hideTypeid").val(),$("#typeid option").each(function(){$(this).val()==tid&&($("#typeid").get(0).selectedIndex=t),t+=1})}function imgpreview(t){var e=$("#file"+t).val();e.length>0?checkImgType(e)?(document.getElementById("pre"+t).src=e,setDesc(t,e)):(showUploadError(t,"图片类型不正确"),$("#file"+t).val(""),document.getElementById("pre"+t).src=defaultpic,$("#desc"+t).val("")):document.getElementById("pre"+t).src=defaultpic}function checkImgType(t){var e=t.lastIndexOf(".");t.substring(e+1)}function setDesc(t,e){var i=e.lastIndexOf("\\");i>-1?(e=e.substring(i+1,e.length),$("#desc"+t).val(e)):$("#desc"+t).val(e)}function showUploadError(t,e){$("#error"+t).text(e).fadeIn("fast").fadeOut(3e3)}function checkUpload(){for(var t,e=0;item>e;e+=1){if(fileval=$("#file"+e).val(),""!=fileval&&null!=fileval){t=!0;break}t=!1}var i=$("#typeid").val();return""==i||null==i?(showUploadError2("请选择相片类别,如果没有可自行创建"),!1):(t||showUploadError2("你还没有选择上传的相片,请选择"),1==i&&$("#uploadform").attr("action","uploadImg2.htm"),t)}function showUploadError2(t){$(".error").text(t).fadeIn("fast").fadeOut(3e3)}var imglist,imgid,pos=0,defaultpic="images/img_preview.gif",item=0,tid;