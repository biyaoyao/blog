function setClickBg(){var e=$("#hideType").val(),t=$("#a"+e).attr("class");$("#a"+e).css("background","url('images/frame"+t+"_visited.jpg') no-repeat center")}function public_validate(e,t){return null==e||e.length>10||e.length<1?(showError("相册名称长度不正确,1-10位"),!1):null==t||t.length>25||t.length<1?(showError("相册描述长度不正确,1-25位"),!1):!0}function opAlbum(e,t,i,n){var s="<div id='typeError' style='margin:20px 20px 20px 20px;text-align:left;width:320px;font-size:12px;color:#000;'><div>名称: <input type='text' id='cat' size='30' value='"+t+"' maxlength='10'/> <span style='color:#999;'>[不超过10个字符]</span></div><div style='margin:5px 0 0px 0;'>描述: <span style='color:#999;'>[最多不能超过25个字符]</span></div><div style='margin:0px 30px;'><textarea id='desc' style='width:290px;height:80px;' >"+i+"</textarea></div><div id='error' style='margin:5px 30px;color:red;'></div><div style='margin:5px 30px';>";n?(s+="<input type='button' value='修改' onclick='alterImgType("+e+")'/>",title="编辑相册"):(s+="<input type='button' value='添加' onclick='addImgType()'/>",title="创建新相册"),s+="</div></div>",Show(s,title,340,80)}function Show(e,t,i,n){var s=new Popup({contentType:2,isReloadOnClose:!1,width:i,height:n});s.setContent("title",t),s.setContent("contentHtml",e),s.build(),s.show()}function alterImgType(e){var t=$("#cat").val(),i=$("#desc").val();public_validate(t,i)&&$.getJSON("editImageType.action",{image_type_id:e,type_name:t,type_desc:i},function(e){e.result?(ShowAlert("编辑相册成功","编辑相册"),location.reload()):showError(e.tips)})}function addImgType(){var e=$("#cat").val(),t=$("#desc").val();public_validate(e,t)&&$.getJSON("addImageType.action",{type_name:e,type_desc:t},function(i){i.result?(ShowAlert("创建新相册成功","创建新相册"),create_new_album(i.myid,e,t)):showError(i.tips),o_pop.reBuild()})}function ShowAlert(e,t){var i=new Popup({contentType:4,isReloadOnClose:!1,width:340,height:70});i.setContent("title",t),i.setContent("alertCon",e),i.build(),i.show()}function create_new_album(e,t,i){str="<li class='li"+e+"'><a href='imgListShow.htm?type="+e+"' class='ls'><img src='images/album_no_pic.gif'/></a><a href='#' id='name"+e+"' class='aname'>"+t+"(0)</a><s:if test='#log!=null'><br><a href=javascript:opAlbum("+e+",'"+t+"','"+i+"',true); class='aop'>√编辑</a><a href='javascript:delAlbum("+e+")' class='aop'>×删除</a></s:if></li>",$("#albumcenter ul").append(str);var n=$("#typeid option");n.length>0&&window.location.reload()}function showError(e){$("#error").text(e).fadeIn("fast").fadeOut(3e3)}function delAlbum(e){var t=new Popup({contentType:3,isReloadOnClose:!1,width:340,height:80});t.setContent("title","删除相册"),t.setContent("confirmCon","您确定要删除这个相册吗?"),t.setContent("callBack",delAlbumCallBack),t.setContent("parameter",{id:e,obj:t}),t.build(),t.show()}function preview(e){var t=new Popup({contentType:2,isReloadOnClose:!1,width:700});t.setContent("title","图片预览"),t.setContent("scrollType","no"),t.setContent("contentHtml","<html><head></style></head><body><img style='width:100%' src='"+e+"'/></body></html>"),t.build(),t.show()}function delAlbumCallBack(e){var t=e.id;t>1&&$.getJSON("deleteImageType.action",{image_type_id:t},function(i){var n=e.obj;n.config.contentType=4,i.result?(n.setContent("alertCon","删除成功,此相册下相片将会全部删除!"),$(".li"+t).hide()):"no_login"==i.tips?login():n.setContent("alertCon",i.tips),n.reBuild()})}function opImg(e,t,i){str="<div style='margin:20px 10px 20px 30px;text-align:left;width:450px;font-size:12px;color:#000;'><div style=''>预览: <span style='color:#999;'></span><div style='margin:0 0 5px 30px;'><img src='"+t+"'/></div></div><div style='margin:5px 0 0px 0;'>描述: <span style='color:#999;'>[最多不能超过15个字符]</span></div><div style='margin:0px 30px;'><textarea id='desc' style='width:290px;height:60px;' >"+i+"</textarea></div><div id='error' style='margin:5px 30px;color:red;'></div><div style='margin:5px 30px';><input type='button' width='120px' value='编辑' onclick='alterImg("+e+")'/></div></div>",Show(str,"编辑图片",500,300)}function alterImg(e){var t=$("#desc").val();return null==t||t.length>15||t.length<1?void showError("相片描述长度不正确,1-15位"):void(e>0&&$.getJSON("editImage.action",{img_id:e,img_desc:t},function(i){i.result?(ShowAlert("编辑相片成功","编辑相片"),$("#name"+e).html(t)):showError(i.tips)}))}function delImg(e){var t=new Popup({contentType:3,isReloadOnClose:!1,width:340,height:60});t.setContent("title","删除相片"),t.setContent("confirmCon","您确定要删除这张相片吗?"),t.setContent("callBack",delImgCallBack),t.setContent("parameter",{id:e,obj:t}),t.build(),t.show()}function delImgCallBack(e){var t=e.id;t>0&&$.getJSON("deleteImage.action",{img_id:t},function(i){o_pop=e.obj,o_pop.config.contentType=4,i.result?(o_pop.setContent("alertCon","删除相片成功"),$(".li"+t).hide()):o_pop.setContent("alertCon","删除相片失败"),o_pop.reBuild()})}function setWidthAndHeight(e){var t,i=400,n=550,s=e.lastIndexOf("*"),a=e.lastIndexOf("|"),r=e.substring(0,s),o=e.substring(s+1,a);$("#si").css("margin-top","0"),r>=n&&(r=n),o>=i?o=i:(t=(i-o)/2,$("#si").css("margin-top",t+"px")),$("#si").css("width",r+"px"),$("#si").css("height",o+"px")}function showBefore(e,t,i){setWidthAndHeight(i),getAllImg(e,t)}function getAllImg(e,t){$.getJSON("imgShowAjax.htm",{id:e,iid:t},function(e){list=e.mylist,id=e.myid;for(var t=0;t<list.length;t+=1)if(list[t].id==id){pos=t+1,0==t?($(".pre").attr("href","javascript:;").attr("title","已经是第一张"),$(".next").attr("href","javascript:showNext("+pos+")").attr("title","下一张")):t==list.length-1?($(".next").attr("href","javascript:;").attr("title","已经是最后一张"),$(".pre").attr("href","javascript:showPre("+pos+")").attr("title","上一张")):($(".pre").attr("href","javascript:showPre("+pos+")").attr("title","上一张"),$(".next").attr("href","javascript:showNext("+pos+")").attr("title","下一张")),$(".current").html(pos);break}getP(list,id)})}function getP(e,t){imglist=e,imgid=t}function setAllInfo(e){e-=1;var t=imglist[e].imgurl,i=imglist[e].imgname,n=imglist[e].imgdesc,s=imglist[e].imginfo,a=imglist[e].time;setWidthAndHeight(s),$(".current").html(e+1),$("#link").attr("href",t+"/"+i),$("#si").attr("src",t+"/"+i),$("#si").attr("alt",n+"--"+s),$(".des").html(n),$(".inf").html(s),$(".tim").html(a)}function showPre(e){1!=e?(pos=e-1,$(".pre").attr("href","javascript:showPre("+pos+")").attr("title","上一张"),$(".next").attr("title","下一张"),setAllInfo(pos)):(pos=e,$(".pre").attr("href","javascript:;").attr("title","已经是第一张")),$(".next").attr("href","javascript:showNext("+pos+")")}function showNext(e){e!=imglist.length?(pos=e+1,$(".pre").attr("title","上一张"),$(".next").attr("href","javascript:showNext("+pos+")").attr("title","下一张"),setAllInfo(pos)):$(".next").attr("href","javascript:;").attr("title","已经是最后一张"),$(".pre").attr("href","javascript:showPre("+pos+")")}function appendFile(e){for(var t="",i=3;5>i;i++)t+='<div class="onefile"><div class="file"><input type="file" name="upload" id="file'+i+'" onchange="fileupload(this,'+i+')" /><br><span id="error'+i+'" class="error"></span></div><div class="preview"><img id="pre'+i+'" src="'+defaultpic+'"/></div><div class="desc">描述:<br><textarea name="desc" id="desc'+i+'"></textarea></div></div>',item+=1;$("#uploadarea").append(t)}function addmore(e){appendFile(e),$(".addmore").hide()}function initTypeId(){var e=0;tid=$("#hideTypeid").val(),$("#typeid option").each(function(){$(this).val()==tid&&($("#typeid").get(0).selectedIndex=e),e+=1})}function imgpreview(e){var t=$("#file"+e).val();t.length>0?checkImgType(t)?(document.getElementById("pre"+e).src=t,setDesc(e,t)):(showUploadError(e,"图片类型不正确"),$("#file"+e).val(""),document.getElementById("pre"+e).src=defaultpic,$("#desc"+e).val("")):document.getElementById("pre"+e).src=defaultpic}function checkImgType(e){var t=e.lastIndexOf(".");e.substring(t+1)}function setDesc(e,t){var i=t.lastIndexOf("\\");i>-1?(t=t.substring(i+1,t.length),$("#desc"+e).val(t)):$("#desc"+e).val(t)}function showUploadError(e,t){$("#error"+e).text(t).fadeIn("fast").fadeOut(3e3)}function checkUpload(){for(var e,t=0;item>t;t+=1){if(fileval=$("#file"+t).val(),""!=fileval&&null!=fileval){e=!0;break}e=!1}var i=$("#typeid").val();return""==i||null==i?(showUploadError2("请选择相片类别,如果没有可自行创建"),!1):(e||showUploadError2("你还没有选择上传的相片,请选择"),1==i&&$("#uploadform").attr("action","uploadImg2.htm"),e)}function showUploadError2(e){$(".error").text(e).fadeIn("fast").fadeOut(3e3)}var imglist,imgid,pos=0,defaultpic="images/img_preview.gif",item=0,tid;