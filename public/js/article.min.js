function getUrl(e){var t,i=window.location.href,n=i.lastIndexOf("#");if(1==e)t=n>0?i.substring(0,n):i;else if(2==e){var r=i.lastIndexOf("?");t=r>0?"articleList":i}return t}function to(e){top.location.href=e}function delArticle(e){var t=new Popup({contentType:3,isReloadOnClose:!0,width:340,height:80});t.setContent("title","删除文章"),t.setContent("confirmCon","您确定要彻底删除这篇文章及其所有评论吗?"),t.setContent("callBack",delArticleCallBack),t.setContent("parameter",{id:e,obj:t}),t.build(),t.show()}function delArticleCallBack(e){var t=e.id;$.getJSON("delArticle",{id:t},function(t){var i;"ok"==t.tips?i="<div style='margin:30px 10px;text-align:center;width:300px;font-size:14px;color:black'>删除文章成功</div>":"no_login"==t.tips?login():i="<div style='margin:30px 10px;text-align:center;width:300px;font-size:14px;color:black'>删除文章失败</div>";var n=e.obj;n.config.contentType=2,n.setContent("title","删除文章"),n.setContent("contentHtml",i),n.reBuild(),setTimeout("to('"+getUrl(2)+"')",1e3)})}function initHover(){$(".op").mouseover(function(){$(this).attr("class","op1")}),$(".op").mouseout(function(){$(this).attr("class","op")})}function add(){var e=$("#cat").val(),t=$("#desc").val();return null==e||e.length>8||e.length<4?void showError("类别长度不正确,长度在4-8 之间"):null==t||t.length>15||t.length<8?void showError("描述长度不正确,长度在8-15 之间"):void $.getJSON("addNewArticleType.action",{type_name:e,type_desc:t},function(t){t.result?(showError("添加成功"),insertIntoListByAjax(e,t.myid)):showError(t.tips)})}function clearTypeNameInput(){$("#cat").val(""),$("#desc").val("")}function insertIntoListByAjax(e,t){clearTypeNameInput();var i="";i+='<div id="tips'+t+'" class="tips"></div><div id="op'+t+'" class="op"><div id="name'+t+'" class="name">'+e+'</div><div id="edit'+t+'" class="edit"><a href="javascript:renameATypeName('+t+');"><img alt="重命名" src="images/edit.gif"/></a></div><div id="del'+t+'" class="del"><a href="javascript:delArticleType('+t+')"><img alt="删除" src="images/del.gif"/></a></div></div>',$("#auto").append(i),initHover()}function showError(e){$(".error").text(e).css("color","red").fadeIn("fast").fadeOut(3e3)}function renameATypeName(e){var t=$("#name"+e),i=$("#edit"+e),n=$("#del"+e),r=$.trim(t.text());t.html("<input type='text' id='typename"+e+"' name='typename' value='"+t.text()+"'/>"),i.html("<a href='#' onclick='confRename("+e+',"'+r+"\")'>修改</a>");var a=$("#typename"+e).val();n.html("<a href=javascript:cancleRename("+e+",'"+a+"')>取消</a>")}function confRename(e,t){var i=$("#typename"+e).val();return t==i?(cancleRename(e,i),void showError2(e,"无修改")):null==i||i.length>8||i.length<4?void showError2(e,"类别长度不正确,长度在4-8 之间"):void $.getJSON("renameArticleType.action",{type_id:e,type_name:i},function(t){t.result?(cancleRename(e,i),showError2(e,"修改成功")):showError2(e,t.tips)})}function cancleRename(e,t){var i=$("#name"+e),n=$("#edit"+e),r=$("#del"+e);i.html(t),n.html('<a href="javascript:renameATypeName('+e+');"><img alt="重命名" src="images/edit.gif"/></a>'),r.html('<a href="javascript:delArticleType('+e+');"><img alt="删除" src="images/del.gif"/></a>')}function delArticleType(e){$.getJSON("delArticleType.action",{type_id:e},function(t){t.result?removeInListByAjax(e):showError2(e,t.tips)})}function removeInListByAjax(e){$("#op"+e).hide(),showError2(e,"删除成功")}function showError2(e,t){$("#tips"+e).text(t).fadeIn("fast").fadeOut(3e3)}function editTypeName(){g_pop=new Popup({contentType:1,scrollType:"no",isReloadOnClose:!0,width:"460",height:"350"}),g_pop.setContent("title","编辑分类"),g_pop.setContent("contentUrl","/articleTypeEdit"),g_pop.build(),g_pop.show()}function initEdit(e){var t=0;$("#a_t option").each(function(){$(this).val()==e&&($("#a_t").get(0).selectedIndex=t),t+=1}),$(".sub").html('<input type="submit" value="确认修改" onclick="return check(-1);"/>')}function trim(e){return e.replace(/(^\s*)|(\s*$)/g,"")}function check(e,t,i){return e=trim(e),t=trim(t),null==e||e.length>20||e.length<1?(showError("标题长度不正确"),!1):null==t||t.length<1?(showError("正文内容不能为空"),!1):null==i||""==i?(showError("请选择文章类别"),!1):!0}function newArticle(){var e=$("#title").val(),t=editor.getContent(),i=$("#a_t").val();$("#author").val();check(e,t,i)&&$("#articleForm").submit()}function callback(e,t){t?(alert(e),location.reload()):alert(e)}function addType(){var e="<div id='typeError' style='margin:20px 70px;text-align:left;width:260px;font-size:12px;color:#000;'><span id='error3'></span><p><p><div>类别名称 <input type='text' id='cat'/><input placeholder='长度在4-8之间' type='button' value='添加' onclick='add3()'/></div><div style='margin:5px 0 10px 0;'>描　　述 <input placeholder='长度在8-15之间' type='text' id='desc' size='27'/></div></div>";ShowAlert(e)}function add3(){var e=$("#desc").val(),t=$("#cat").val();return null==t||t.length>8||t.length<4?void showError3("类别长度不正确,长度在4-8 之间"):null==e||e.length>15||e.length<8?void showError3("描述长度不正确,长度在8-15 之间"):void $.getJSON("/addNewArticleType.action",{type_name:t,type_desc:e},function(e){e.result?(showError3(e.tips),location.reload()):showError3(e.tips)})}function showError3(e){$("#error3").text(e).fadeIn("fast").fadeOut(3e3)}function ShowAlert(e){pop=new Popup({contentType:2,isReloadOnClose:!0,width:340,height:80}),pop.setContent("title","创建新文章/修改文章"),pop.setContent("contentHtml",e),pop.build(),pop.show()}function delComment(e){var t=new Popup({contentType:3,isReloadOnClose:!0,width:340,height:80});t.setContent("title","删除评论"),t.setContent("confirmCon","您确定删除这条评论吗?"),t.setContent("callBack",delCommentCallBack),t.setContent("parameter",{id:e,obj:t}),t.build(),t.show()}function delCommentCallBack(e){var t=e.id;$.getJSON("delComment",{id:t},function(t){var i;"no_login"==t.tips?login():i="ok"==t.tips?"<div style='margin:30px 10px;text-align:center;width:300px;font-size:14px;color:black'>删除评论成功</div>":"<div style='margin:30px 10px;text-align:center;width:300px;font-size:14px;color:black'>删除评论失败</div>";var n=e.obj;n.config.contentType=2,n.setContent("title","删除评论"),n.setContent("contentHtml",i),n.reBuild(),setTimeout("to('"+getUrl(1)+"')",1e3)})}var arr,pop;